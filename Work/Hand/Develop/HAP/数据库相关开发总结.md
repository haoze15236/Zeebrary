# Mybatis批量操作

- **批量删除**

```XML
<delete id="deleteBatch">
    <if test="list != null and list.size>0">
        delete from puma_employee_basic where employee_no in
        <foreach collection="list" item="item" open="(" separator="," close=")">
            #{item.employeeNo}
        </foreach>
    </if>
</delete>
```

- **批量插入**

```xml
<insert id="insertBatch" useGeneratedKeys="true" keyProperty="unitId">
        <if test="list != null and list.size > 0">
            INSERT INTO csh_repayment_register_head_itf(UNIT_CODE
          ,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,OBJECT_VERSION_NUMBER,REQUEST_ID,PROGRAM_ID,LAST_UPDATE_LOGIN) VALUES
            <foreach collection="list" item="item" index="index" separator=",">
                (#{item.unitCode},#{request.userId} ,now() ,#{request.userId},now() ,1 ,null ,null ,#{request.userId})
            </foreach>
        </if>
    </insert>
```

- **批量更新**

```xml
<update id="updateBatch">
        <if test="list != null and list.size > 0">
            <foreach collection="list" item="item" index="index" separator=";">
                update csh_repayment_register_head_itf
                set SYNC_STATUS = IFNULL(#{item.syncStatus},SYNC_STATUS)
                ,LAST_UPDATED_BY =  #{request.userId}
                ,LAST_UPDATE_DATE = now()
                ,OBJECT_VERSION_NUMBER = OBJECT_VERSION_NUMBER + 1
                WHERE 1=1
                AND EMPLOYEE_ID = #{item.employeeId}
                AND OBJECT_VERSION_NUMBER = #{item.objectVersionNumber};
                update exp_org_unit_tl
                set DESCRIPTION = IFNULL(#{item.description},DESCRIPTION)
                where UNIT_ID = #{item.unitId}
            </foreach>
        </if>
    </update>
```

# 错误合集

- ```shell
  nested exception is org.apache.ibatis.binding.BindingException: Parameter '__frch_item_0' not found. Available parameters are [collection, list]
  ```

  - 查看parameterType的类型是不是Java.util.List类型
  - 看foreach的collection属性是不是list
  - 看foreach里取的属性值是否写错，大小写是否相同
  - 查看foreach里取的属性值实体对象中是否存在

# 数据库脚本

```sql
--根据表名查出对应字段
SELECT GROUP_CONCAT(C.COLUMN_NAME) FROM information_schema.COLUMNS C WHERE C.TABLE_NAME = 'csh_repayment_register_head_itf'
--查询出插入字段语句
SELECT lower(GROUP_CONCAT('#{item.',C.COLUMN_NAME,'}')) FROM information_schema.COLUMNS C WHERE C.TABLE_NAME = 'csh_repayment_register_head_itf'
```

[下划线转驼峰](https://www.bejson.com/convert/camel_underscore/)